# UX改善 & 将来拡張ロードマップ

## 概要
P2: UI/UXの一貫性向上（空状態・ローディング・エラー表示の統一）
P3: 将来的な機能拡張の方向性（分析ダッシュボード・マルチストア・RAG等）

---

## P2: UX改善

### 現状分析

#### 空状態（Empty State）
- `EmptyState` コンポーネントは存在するが、全画面で統一的に使われていない
- 初回利用時に「何をすべきか」のガイダンスが不足
- 業種別の空状態メッセージがない

#### ローディング状態
- `SkeletonList` コンポーネント、`Icon spinner`、何も表示しないパターンが混在
- ページ間でローディングUXが統一されていない

#### エラー状態
- API失敗時のリトライUIがない
- ネットワーク切断時の表示がない
- エラーメッセージが技術的すぎる箇所がある

---

### 1. 空状態の統一

#### 監査対象ページ

| ページ | 現状 | 改善案 |
|--------|------|--------|
| `Customers.tsx` | 基本的なEmptyState | 「最初のお客様を登録しましょう」+ 登録ボタン |
| `RecordList.tsx` | 未確認 | 業種別メッセージ（「カルテを作成しましょう」/「連絡帳を作成しましょう」） |
| `ReservationsCalendar.tsx` | カレンダー表示のみ | 予約ゼロ時に「最初の予約を追加しましょう」 |
| `JournalList.tsx` | 未確認 | 「連絡帳を作成しましょう」 |
| `ContractEdit.tsx` | 未確認 | 契約未登録時のガイダンス |
| `AnnouncementList.tsx` | 未確認 | 「お知らせを投稿しましょう」 |

#### 実装方針

既存の `EmptyState` コンポーネントを拡張:

```typescript
interface EmptyStateProps {
  icon: string
  title: string
  description: string
  actionLabel?: string
  onAction?: () => void
  variant?: 'default' | 'compact' // compact = リスト内の小さい表示
}
```

#### 対象ファイル
- 各リスト画面（上記表のページ）
- `client/src/components/EmptyState.tsx`（拡張）

---

### 2. ローディング状態の統一

#### 方針
- リスト画面: `SkeletonList` に統一
- 詳細画面: `SkeletonDetail`（カード型のスケルトン）を新規作成
- ボタン操作: ボタン内スピナーに統一

```typescript
// 統一ローディングコンポーネント
// client/src/components/LoadingState.tsx

export function ListSkeleton({ rows = 5 }: { rows?: number }) {
  return (
    <div className="space-y-3">
      {Array.from({ length: rows }).map((_, i) => (
        <div key={i} className="bg-card rounded-2xl p-4 animate-pulse">
          <div className="h-4 bg-muted rounded w-2/3 mb-2" />
          <div className="h-3 bg-muted rounded w-1/3" />
        </div>
      ))}
    </div>
  )
}

export function DetailSkeleton() {
  return (
    <div className="space-y-4 animate-pulse">
      <div className="bg-card rounded-2xl p-6">
        <div className="h-6 bg-muted rounded w-1/2 mb-4" />
        <div className="h-4 bg-muted rounded w-full mb-2" />
        <div className="h-4 bg-muted rounded w-3/4" />
      </div>
    </div>
  )
}
```

#### 対象ファイル
- 新規: `client/src/components/LoadingState.tsx`
- 各ページで `isLoading` 表示部分を統一

---

### 3. エラー状態の改善

#### リトライUI

```typescript
// client/src/components/ErrorState.tsx

export function ErrorState({
  message = 'データの取得に失敗しました',
  onRetry,
}: {
  message?: string
  onRetry?: () => void
}) {
  return (
    <div className="text-center py-12">
      <Icon icon="solar:danger-triangle-bold" width="48" className="text-destructive mx-auto mb-3" />
      <p className="text-muted-foreground mb-4">{message}</p>
      {onRetry && (
        <button onClick={onRetry} className="text-primary text-sm font-medium">
          再読み込み
        </button>
      )}
    </div>
  )
}
```

#### SWRのエラーハンドリング統一

```typescript
// 各ページで統一パターン
const { data, error, mutate } = useSWR('/api/xxx', fetcher)

if (error) {
  return <ErrorState onRetry={() => mutate()} />
}
```

#### 対象ファイル
- 新規: `client/src/components/ErrorState.tsx`
- 各ページのエラー表示部分

---

### 検証チェックリスト（P2）

- [ ] 全リスト画面でデータ0件時に適切な空状態が表示されること
- [ ] 空状態にアクションボタンが付いていること（該当する場合）
- [ ] 全画面でローディング中にスケルトン表示されること
- [ ] API失敗時にリトライボタンが表示されること
- [ ] エラーメッセージがユーザーフレンドリーであること

---

## P3: 将来拡張ロードマップ

以下は、ユーザー基盤拡大後（100店舗〜）に検討する機能。
現時点では概要のみ記載。

### 1. 店舗オーナー向け分析ダッシュボード

**目的**: 経営判断に使えるデータ可視化

**想定機能**:
- 期間別統計（予約数推移、顧客数推移、業種別内訳）
- リピート率・来店頻度分析
- AI利用統計（生成回数、採用率、平均品質スコア）
- PDF/CSVレポートエクスポート

**技術方針**:
- 新規API: `server/src/routes/analytics.ts`
- 新規画面: `client/src/pages/Analytics.tsx`
- チャートライブラリ: Recharts（React向け軽量チャート）
- パフォーマンス: マテリアライズドビューまたはキャッシュで重いクエリを最適化

---

### 2. マルチストア対応（Proプラン）

**目的**: 複数店舗経営者向けの統合管理

**想定機能**:
- 店舗切り替えUI（ヘッダーにストアセレクター）
- 複数店舗のダッシュボード集計
- 店舗間のスタッフ共有
- 統合請求管理

**技術方針**:
- `stores` テーブルに `parent_store_id` カラム追加
- `authStore.ts` に `availableStores` 状態追加
- auth middleware で親子ストア間のアクセス制御
- Pro プラン(`008_billing.sql`)の `multi_store: true` を実際にチェック

**参考**: `billing.ts` の `plans` テーブルに `features JSONB` があり、`multi_store` フラグ定義済み

---

### 3. RAG実装（Plan 05 参照）

**目的**: 過去のレポートを意味的に検索し、AI出力の品質を向上

**想定機能**:
- pgvector による類似度検索
- Gemini Embedding API でベクトル生成
- 類似カルテの自動参照

**前提条件**: ユーザー基盤拡大後（学習データの蓄積が必要）
**詳細**: `Blink_renewal/05_RAG実装計画.md` を参照

---

### 4. スタッフシフト管理

**目的**: 予約とスタッフの勤務時間をマッチング

**想定機能**:
- スタッフ別の勤務スケジュール管理
- 予約作成時に担当スタッフの空き確認
- シフト表の表示・印刷
- リソース（部屋・テーブル）の管理

---

### 5. メールマーケティング連携

**目的**: 顧客リテンション向上

**想定機能**:
- 誕生日キャンペーンの自動メール配信
- 長期不来店フォローアップ
- ニュースレター管理
- テンプレートエディタ

**技術方針**: Resend API（既存で使用中）を活用

---

## 実装ステータス

### P2: UX改善
- [ ] 空状態の全画面監査 📋
- [ ] EmptyStateコンポーネント拡張 📋
- [ ] ローディング状態の統一 📋
- [ ] エラー状態コンポーネント作成 📋
- [ ] SWRエラーハンドリング統一 📋

### P3: 将来拡張
- [ ] 分析ダッシュボード 📋（100店舗〜）
- [ ] マルチストア対応 📋（Pro需要発生時）
- [ ] RAG実装 📋（学習データ蓄積後）
- [ ] スタッフシフト管理 📋（要望次第）
- [ ] メールマーケティング 📋（要望次第）
