# 問題修正計画：トリミングピクト & ダッシュボード業種切替

## 報告された問題

1. **トリミングのピクトがおかしい**
2. **ダッシュボードが業種で切り替わらない（登園前・登園中…のまま）**

---

## 調査結果

### 問題1: トリミングのピクトグラム不整合

**原因:** アイコン定義が2種類存在し、不統一

| ファイル | アイコン |
|---------|---------|
| `businessTypeColors.ts` | `mdi:content-cut` |
| 他の全ファイル | `solar:scissors-bold` |

**影響箇所:**
- `Onboarding.tsx` - 業種選択画面
- `StoreTab.tsx` - トリミング設定（2箇所）
- `GroomingMenuEdit.tsx` - メニュー編集
- `liff/pages/RecordDetail.tsx` - LIFFカルテ詳細
- `liff/pages/RecordList.tsx` - LIFFカルテ一覧

**注:** `mdi:content-cut`は「テキストカット」アイコン、`solar:scissors-bold`はハサミアイコン

---

### 問題2: ダッシュボードが業種で切り替わらない

**原因:** `Dashboard.tsx`の`getStatusLabel()`が業種パラメータを受け取っていない

```tsx
// 現在のコード（業種無視）
function getStatusLabel(status: DisplayStatus): string {
  switch (status) {
    case '来園待ち': return '登園前'  // 常に保育園用
    case '在園中': return '利用中'
    case '帰宅済': return '帰宅済み'
  }
}
```

**既に存在する正しい定義（未使用）:**
- `businessTypeMessages.ts` に `STATUS_LABELS` と `getStatusLabel()` が定義済み
- しかし `Dashboard.tsx` ではインポートされていない

**影響範囲:**
- フィルターボタン（「登園前」「利用中」など）
- ステータスラベル表示
- 「登園」「降園」ボタンのテキスト

---

## 修正内容

### 修正1: トリミングアイコンの統一

**ファイル:** `client/src/utils/businessTypeColors.ts` (行17)

```tsx
// 変更前
icon: 'mdi:content-cut',

// 変更後
icon: 'solar:scissors-bold',
```

---

### 修正2: ダッシュボード業種対応

**ファイル:** `client/src/pages/Dashboard.tsx`

#### 2-1. 業種別ラベル定義を追加

```tsx
const BUSINESS_TYPE_LABELS: Record<RecordType, {
  waiting: string
  active: string
  done: string
  checkIn: string
  checkOut: string
}> = {
  daycare: {
    waiting: '登園前', active: '登園中', done: '降園済',
    checkIn: '登園', checkOut: '降園',
  },
  grooming: {
    waiting: '来店前', active: '施術中', done: '完了',
    checkIn: '来店', checkOut: '完了',
  },
  hotel: {
    waiting: 'チェックイン前', active: 'お預かり中', done: 'チェックアウト済',
    checkIn: 'チェックイン', checkOut: 'チェックアウト',
  },
}
```

#### 2-2. FILTER_OPTIONS を関数に変更（トリミング2ステータス対応）

```tsx
function getFilterOptions(businessType: RecordType | null): FilterConfig[] {
  const l = BUSINESS_TYPE_LABELS[businessType || 'daycare'] || BUSINESS_TYPE_LABELS.daycare

  // トリミングは2ステータスのみ（来店前・完了）
  if (businessType === 'grooming') {
    return [
      { id: 'all', label: 'すべて', icon: 'solar:list-bold', borderColor: 'border-primary' },
      { id: '来園待ち', label: l.waiting, icon: 'solar:clock-circle-bold', borderColor: 'border-chart-4' },
      { id: '帰宅済', label: l.done, icon: 'solar:check-circle-bold', borderColor: 'border-chart-3' },
    ]
  }

  // daycare, hotel は3ステータス
  return [
    { id: 'all', label: 'すべて', icon: 'solar:list-bold', borderColor: 'border-primary' },
    { id: '来園待ち', label: l.waiting, icon: 'solar:clock-circle-bold', borderColor: 'border-chart-4' },
    { id: '在園中', label: l.active, icon: 'solar:home-smile-bold', borderColor: 'border-chart-2' },
    { id: '帰宅済', label: l.done, icon: 'solar:check-circle-bold', borderColor: 'border-chart-3' },
  ]
}
```

#### 2-3. getStatusLabel を業種対応に変更

```tsx
function getStatusLabel(status: DisplayStatus, businessType: RecordType | null): string {
  const l = BUSINESS_TYPE_LABELS[businessType || 'daycare'] || BUSINESS_TYPE_LABELS.daycare
  switch (status) {
    case '来園待ち': return l.waiting
    case '在園中': return l.active
    case '帰宅済': return l.done
  }
}
```

#### 2-4. ReservationCard に businessType を渡す

- propsに `businessType: RecordType | null` 追加
- 「登園」ボタン → `{labels.checkIn}`
- 「降園」ボタン → `{labels.checkOut}`
- getStatusLabel呼び出しに businessType パラメータ追加

#### 2-5. トリミングは「来店」で直接完了へ

トリミングは「施術中」をトラッキングする術がないため、2ステータス運用:
- 来店前 → 「来店」ボタン → 完了（降園済）

```tsx
// isWaiting時のボタン処理
{isWaiting && (
  <button
    onClick={() => businessType === 'grooming'
      ? onCheckOut(reservation.id)  // トリミングは直接完了へ
      : onCheckIn(reservation.id)}  // その他は登園済へ
  >
    {labels.checkIn}
  </button>
)}
```

---

## 修正対象ファイル

| ファイル | 修正内容 |
|----------|---------|
| `client/src/utils/businessTypeColors.ts` | アイコンを`solar:scissors-bold`に統一 |
| `client/src/pages/Dashboard.tsx` | 業種対応のステータス表示・フィルター・ボタン |

---

## 検証方法

1. `npm run build` でビルド成功確認
2. 開発サーバーで確認:
   - 業種をトリミングに切り替え → アイコンがハサミ（統一）
   - ダッシュボードのフィルター → 「すべて」「来店前」「完了」の3つ（施術中なし）
   - 「来店」ボタン押下 → 直接「完了」ステータスへ遷移

---

## 実装日

2024年2月5日
